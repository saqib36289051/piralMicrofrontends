var piralFeeds=(()=>{var K=Object.create;var m=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var P=t=>m(t,"__esModule",{value:!0});var s=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(e,r)=>(typeof require!="undefined"?require:e)[r]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var b=(t,e)=>{P(t);for(var r in e)m(t,r,{get:e[r],enumerable:!0})},k=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of V(e))!j.call(t,o)&&o!=="default"&&m(t,o,{get:()=>e[o],enumerable:!(r=N(e,o))||r.enumerable});return t},c=t=>k(P(m(t!=null?K(_(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var H={};b(H,{createFeedsApi:()=>B,useFeed:()=>D,withFeed:()=>g});var y={};b(y,{createFeed:()=>L,destroyFeed:()=>$,loadFeed:()=>q,loadedFeed:()=>l,updateFeed:()=>x});var f=c(s("piral-core"));function L(t,e){t.dispatch(r=>({...r,feeds:(0,f.withKey)(r.feeds,e,{data:void 0,error:void 0,loaded:!1,loading:!1})}))}function $(t,e){t.dispatch(r=>({...r,feeds:(0,f.withoutKey)(r.feeds,e)}))}function q(t,e){let{id:r}=e;return t.dispatch(o=>({...o,feeds:(0,f.withKey)(o.feeds,r,{data:void 0,error:void 0,loaded:!1,loading:!0})})),e.initialize().then(o=>{l(t,r,o,void 0),e.dispose=e.connect(n=>{x(t,r,n,e.update)})},o=>l(t,r,void 0,o))}function l(t,e,r,o){t.dispatch(n=>({...n,feeds:(0,f.withKey)(n.feeds,e,{loading:!1,loaded:!0,error:o,data:r})}))}function x(t,e,r,o){let n=t.readState(a=>a.feeds[e]),i=o(n.data,r);if(i instanceof Promise)return i.then(a=>l(t,e,a,void 0)).catch(a=>l(t,e,void 0,a));i!==n.data&&l(t,e,i,void 0)}var A=c(s("piral-core"));var T=c(s("react")),C=c(s("piral-core"));var R=c(s("react")),F=c(s("piral-core"));function D(t){let{loaded:e,loading:r,error:o,data:n}=(0,F.useGlobalState)(a=>a.feeds[t.id]),i=(0,F.useAction)("loadFeed");return(0,R.useEffect)(()=>{!e&&!r&&i(t)},[e]),[e,n,o]}function g(t,e){let r=o=>{let[n,i,a]=D(e);return n?i?T.createElement(t,{...o,data:i}):T.createElement(C.RegisteredErrorInfo,{type:"feed",error:a}):T.createElement(C.RegisteredLoadingIndicator,null)};return r.displayName=`FeedView_${e.id}`,r}var w=c(s("piral-core")),S=()=>{};function G(t,e){return(0,w.isfunc)(e)?{id:t,initialize(){return e()},connect(){return S},update(r){return Promise.resolve(r)},immediately:!1,reducers:{}}:{id:t,initialize(){return e.initialize()},connect(r){return typeof e.connect=="function"?e.connect(r):S},update(r,o){return typeof e.update=="function"?e.update(r,o):Promise.resolve(r)},immediately:e.immediately,reducers:e.reducers||{}}}function B(t={}){return e=>(e.defineActions(y),e.dispatch(r=>({...r,feeds:{}})),(r,o)=>{let n=0;return{createConnector(i){let a=(0,A.buildName)(o.name,n++),d=G(a,i),h=()=>{d.dispose?.(),e.createFeed(d.id)};d.immediately?e.loadFeed(d):h();let u=p=>g(p,d);return Object.keys(d.reducers).forEach(p=>{let I=d.reducers[p];typeof I=="function"&&(u[p]=(...O)=>{e.updateFeed(a,O,(z,E)=>I.call(u,z,...E))})}),u.invalidate=h,u}}})}return H;})();
