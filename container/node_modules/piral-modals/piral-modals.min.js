var piralModals=(()=>{var v=Object.create;var f=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var B=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var b=o=>f(o,"__esModule",{value:!0});var p=(o=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(o,{get:(t,l)=>(typeof require!="undefined"?require:t)[l]}):o)(function(o){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+o+'" is not supported')});var A=(o,t)=>{b(o);for(var l in t)f(o,l,{get:t[l],enumerable:!0})},N=(o,t,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of I(t))!F.call(o,a)&&a!=="default"&&f(o,a,{get:()=>t[a],enumerable:!(l=w(t,a))||l.enumerable});return o},c=o=>N(b(f(o!=null?v(B(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0})),o);var J={};A(J,{Modals:()=>y,PiralModalsDialog:()=>C,PiralModalsHost:()=>x,createModalsApi:()=>z});var D={};A(D,{closeModal:()=>k,openModal:()=>$,registerModal:()=>E,unregisterModal:()=>K});var n=c(p("piral-core"));function $(o,t){o.dispatch(l=>({...l,modals:(0,n.prependItem)(l.modals,t)}))}function k(o,t){o.dispatch(l=>({...l,modals:(0,n.excludeOn)(l.modals,a=>a.id===t.id)}))}function E(o,t,l){o.dispatch(a=>({...a,registry:{...a.registry,modals:(0,n.withKey)(a.registry.modals,t,l)}}))}function K(o,t){o.dispatch(l=>({...l,registry:{...l.registry,modals:(0,n.withoutKey)(l.registry.modals,t)}}))}var s=c(p("piral-core"));var h=c(p("react")),G=c(p("piral-core")),H=o=>h.createElement("div",{className:"piral-modals-host"},o.open&&h.createElement("div",{className:"piral-modals-overlay"},o.children)),O=o=>(0,G.defaultRender)(o.children);var u=c(p("react")),R=c(p("piral-core"));var P=c(p("piral-core")),x=(0,P.getPiralComponent)("ModalsHost"),C=(0,P.getPiralComponent)("ModalsDialog");function L(o){o.forEach(t=>t.close())}function T(o,t){if(t){let[l]=Object.keys(o).filter(a=>o[a].name===t).map(a=>o[a]);return l}}var y=()=>{let o=(0,R.useGlobalState)(e=>e.registry.modals),t=(0,R.useGlobalState)(e=>e.modals),l=()=>L(t),a=t.map(e=>{let r=o[e.name]||T(o,e.alternative),i=r&&r.component,d={...r&&r.defaults,...e.options};return i&&u.createElement(C,{...e,options:d,defaults:r.defaults,layout:r.layout,key:e.name},u.createElement(i,{onClose:e.close,options:d}))}).filter(Boolean),m=a.length>0;return u.createElement(x,{open:m,close:l},a)};y.displayName="Modals";function j(o){let t={};for(let{name:l,component:a,defaults:m,layout:e={}}of o)t[`global-${l}`]={pilet:void 0,name:l,component:a,defaults:m,layout:e};return t}function q(o){return t=>({...t,components:{ModalsHost:H,ModalsDialog:O,...t.components},registry:{...t.registry,modals:o},modals:[]})}function z(o={}){let{dialogs:t=[],selectId:l=a=>`${a}-${~~(Math.random()*1e4)}`}=o;return a=>(a.defineActions(D),a.dispatch((0,s.withAll)(q(j(t)),(0,s.withRootExtension)("piral-modals",y))),(m,e)=>{let r=e.name;return{showModal(i,g){let d=(0,s.buildName)(r,i),M={id:l(d),name:d,alternative:i,options:g,close(){a.closeModal(M)}};return a.openModal(M),M.close},registerModal(i,g,d,M={}){let S=(0,s.buildName)(r,i);return a.registerModal(S,{pilet:r,name:i,component:(0,s.withApi)(a,g,m,"modal"),defaults:d,layout:M}),()=>m.unregisterModal(i)},unregisterModal(i){let g=(0,s.buildName)(r,i);a.unregisterModal(g)}}})}return J;})();
